<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Which Stitch?</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>

<form class="submit-photo" action="https://whichstitch.herokuapp.com/api" method="POST" role="form" enctype="multipart/form-data">
        <input id="imageFile" type="file"><input type="button" value="Resize Image" onclick="ResizeImage()"/>
        <img src="" id="output" name="output">
        <button id="predictbtn" onclick="api_call()">Predict</button>
</form>

    <br>
<script type="text/javascript">
    function api_call() {
        input = document.getElementById('output');
        console.log("starting call");
        var formData = new FormData();
        formData.append("image", input);
        $.ajax({
            url: 'https://whichstitch.herokuapp.com/api',
            method: 'POST',
            contentType: false,
            processData: false,
            data: formData, // new FormData($('form')[0]),
            dataType: 'json',
            cache: false,
            async: false,
            success: function( response ){
                console.log(response);
                console.log("success!");
            },
            error: function( error ){
                // $('#api_output').html( "There was an error" );
                console.log( error );
            },
            timeout: 120000
        });
    }
    function ResizeImage() {
        var filesToUpload = document.getElementById('imageFile').files;
        var file = filesToUpload[0];

        // Create an image
        var img = document.createElement("img");
        // Create a file reader
        var reader = new FileReader();
        // Set the image once loaded into file reader
        reader.onload = function(e) {
            img.src = e.target.result;

            var canvas = document.createElement("canvas");
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0);

            var MAX_WIDTH = 100;
            var MAX_HEIGHT = 100;
            var width = img.width;
            var height = img.height;

            if (width > height) {
                if (width > MAX_WIDTH) {
                    height *= MAX_WIDTH / width;
                    width = MAX_WIDTH;
                }
            } else {
                if (height > MAX_HEIGHT) {
                    width *= MAX_HEIGHT / height;
                    height = MAX_HEIGHT;
                }
            }
            canvas.width = width;
            canvas.height = height;
            ctx.drawImage(img, 0, 0, width, height);

            var dataurl = canvas.toDataURL("image/jpg");
            outputimg = document.getElementById('output');
            outputimg.src = dataurl;

        }
        // Load files into file reader
        reader.readAsDataURL(file);
    };

</script>
<script type="text/javascript">

</script>
</html>